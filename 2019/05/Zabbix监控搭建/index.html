<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Zabbix监控搭建 | Outsrkem</title><meta name="generator" content="hexo-theme-ayer"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/dist/main.css"><link rel="stylesheet" href="/css/fonts/remixicon.css"><link rel="stylesheet" href="/css/custom.css"><script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script><script src="https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js"></script><style>.swal2-styled.swal2-confirm{font-size:1.6rem}</style></head></html><body><div id="app"><main class="content on"><section class="outer"><article id="post-Zabbix监控搭建" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title sea-center" style="border-left:0" itemprop="name"> Zabbix监控搭建</h1></header><div class="article-meta"> <a href="/2019/05/Zabbix%E7%9B%91%E6%8E%A7%E6%90%AD%E5%BB%BA/index.html" class="article-date"><time datetime="2019-05-12T02:16:02.000Z" itemprop="datePublished">2019-05-12 10:16:02 +08:00</time></a><div class="article-category"> <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1/">服务</a> / <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1/%E7%9B%91%E6%8E%A7/">监控</a></div><div class="word_count"><span class="post-time"><span class="post-meta-item-icon"><i class="ri-quill-pen-line"></i> <span class="post-meta-item-text">字数统计:</span> <span class="post-count">1.9k</span></span></span> <span class="post-time">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="ri-book-open-line"></i> <span class="post-meta-item-text">阅读时长≈</span> <span class="post-count">9 分钟</span></span></span></div></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><h2 id="zabbix监控搭建">Zabbix监控搭建</h2><h4 id="zabbix概述">Zabbix概述</h4><p>       zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案 ( 基于 GPL V2 )zabbix由 2 部分构成，zabbix server与可选组件zabbix agent</p><h4 id="进程构成">进程构成</h4><p>zabbix 安装完成后会产生 5 个程序：zabbix_agentd、zabbix_get、zabbix_proxy、zabbix_sender、zabbix_server，zabbix_java_gateway是可选，这个需要另外安装</p><ul><li><p>zabbix_agentd<br>        客户端守护进程，此进程收集客户端数据，例如 cpu负载、内存、硬盘使用情况等</p></li><li><p>zabbix_get<br>        zabbix工具，单独使用的命令，通常用于排错</p></li><li><p>zabbix_sender<br>        zabbix工具，用于发送数据给 server 或者 proxy ，在脚本完成之后使用 sender 主动将数据提交</p></li><li><p>zabbix_server<br>        zabbix 服务端守护进程，所有的数据都是被提交或主动提交到 zabbix_server 端</p></li><li><p>zabbix_proxy<br>        zabbix代理守护进程。功能类似server，唯一不同的是它只是一个中转站，它需要把收集到的数据提交/被提交到server里</p></li><li><p>zabbix_java_gateway<br>        zabbix2.0之后引入的一个功能。顾名思义：Java网关，类似agentd，但是只用于Java方面。需要特别注意的是，它只能主动去获取数据，而不能被动获取数据。它的数据最终会给到server或者proxy</p></li></ul><h4 id="硬件需求">硬件需求</h4><table><thead><tr><th>Name</th><th>Platform</th><th>CPU/Mem</th><th>Databases</th><th>Monitored host</th></tr></thead><tbody><tr><td>Small</td><td>Ubuntu linux</td><td>PII 350Mhz 256Mb</td><td>SQLite</td><td>20</td></tr><tr><td>Medium</td><td>Ubuntu linux 64 bit</td><td>AMD Athlon 3200+ 2GB</td><td>MySQL InnoDB</td><td>500</td></tr><tr><td>Large</td><td>Ubuntu linux 64 bit</td><td>Intel Dual Core 6400 4GB</td><td>RAID10 MySQL InnoDB or PostgreSQL</td><td>&gt;1000</td></tr><tr><td>very</td><td>RedHat Enterprise</td><td>Intel Xeon 2xCPU 8GB</td><td>Fast RAID10 MySQL InnoDB or PostgreSQL</td><td>&gt;10000</td></tr></tbody></table><h4 id="zabbix搭建，使用centos-7搭建">Zabbix搭建，使用CentOS 7搭建</h4><h5 id="一、初始化系统设置">一、初始化系统设置</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># systemctl stop firewalld</span><br><span class="line"># systemctl disable firewalld</span><br><span class="line"># setenforce 0</span><br><span class="line"># sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span><br></pre></td></tr></table></figure><h5 id="二、安装-lamp环境">二、安装 LAMP环境</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># cd /etc/yum.repos.d/</span><br><span class="line"># wget http://mirrors.163.com/.help/CentOS7-Base-163.repo</span><br><span class="line"># yum clean all &amp;&amp; yum makecache	//清空缓存并建立元数据</span><br><span class="line"># yum -y install mariadb mariadb-server httpd php php-mysql </span><br><span class="line"># systemctl enable httpd &amp;&amp; systemctl restart httpd	//添加开机自启并重启服务</span><br><span class="line"># systemctl enable mariadb &amp;&amp; systemctl restart mariadb	//添加开机自启并重启服务	</span><br><span class="line"># mysql_secure_installation	//初始化数据库，全部回答“y”</span><br><span class="line"># systemctl is-enabled mariadb	//查询是否开机自启</span><br></pre></td></tr></table></figure><h5 id="三、安装-zabbix 程序，以下需联网安装，光盘yum源没有安装包。">三、安装 Zabbix 程序，以下需联网安装，光盘yum源没有安装包。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># rpm -ivh http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm</span><br><span class="line"># rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX</span><br><span class="line"># yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent</span><br></pre></td></tr></table></figure><h6 id="配置初始数据库：">配置初始数据库：</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># mysql -u root -p</span><br><span class="line">&gt; CREATE DATABASE zabbix DEFAULT CHARACTER SET utf8 COLLATE utf8_bin;</span><br><span class="line">&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &#x27;zabbix&#x27;; </span><br><span class="line">&gt; exit</span><br><span class="line">导入数据库</span><br><span class="line"># cd /usr/share/doc/zabbix-server-mysql-3.2.11 </span><br><span class="line"># zcat create.sql.gz | mysql -uroot -p zabbix     //导入数据库</span><br><span class="line"></span><br><span class="line">启动 Zabbix 服务</span><br><span class="line"># vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">DBHost=localhost</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line"># systemctl enable zabbix-server &amp;&amp; systemctl start zabbix-server</span><br><span class="line"></span><br><span class="line">编辑 zabbix 前端 php 配置</span><br><span class="line"># vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">php_value max_execution_time 300 </span><br><span class="line">php_value memory_limit 128M </span><br><span class="line">php_value post_max_size 16M </span><br><span class="line">php_value upload_max_filesize 2M </span><br><span class="line">php_value max_input_time 300 </span><br><span class="line">php_value always_populate_raw_post_data -1 </span><br><span class="line">php_value date.timezone Asia/Shanghai</span><br><span class="line"></span><br><span class="line">调整时间同步</span><br><span class="line"># yum -y install ntpdate </span><br><span class="line"># ntpdate cn.pool.ntp.org</span><br><span class="line"># systemctl restart httpd //重启 Apache 服务生效</span><br></pre></td></tr></table></figure><h4 id="四、修改中文乱码问题">四、修改中文乱码问题</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Win+R	&gt;	fonts	&gt;	拷贝中文字体改名为 msyh.ttf	&gt;	</span><br><span class="line">将字体拷贝到该目录下 /usr/share/zabbix/fonts</span><br><span class="line">[root@localhost ~]# vim /usr/share/zabbix/include/defines.inc.php</span><br><span class="line">修改 zabbix php 页面配置，将&#x27;graphfont&#x27; 修改为 msyh</span><br><span class="line">define(&#x27;ZBX_GRAPH_FONT_NAME&#x27;, &#x27;msyh&#x27;);</span><br></pre></td></tr></table></figure><h4 id="五、添加客户端">五、添加客户端</h4><h6 id="linux配置">linux配置</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">导入安装包	</span><br><span class="line">(CentOS 7)zabbix-agent-3.2.1-1.el7.x86_64.rpm</span><br><span class="line">(CentOS 6)zabbix-agent-3.2.6-1.el6.x86_64.rpm</span><br><span class="line"># yum –y install zabbix-agent-3.2.1-1.el7.x86_64.rpm</span><br><span class="line"># vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=10.10.10.11 //zabbix服务器ip</span><br><span class="line">ServerActive=10.10.10.11	//zabbix服务器ip</span><br><span class="line">Hostname=10.10.10.11	//自己的ip</span><br><span class="line"># systemctl enable zabbix-agent &amp;&amp; systemctl restart zabbix-agent	//CentOS-7</span><br><span class="line"># chkconfig zabbix-agent on &amp;&amp; service zabbix-agent start	//CentOS-6.8</span><br></pre></td></tr></table></figure><h6 id="windows端配置">Windows端配置</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">将bin和conf目录放在C:\zabbix中</span><br><span class="line">修改C:\zabbix\conf\zabbix_agentd.conf配置文件下面三项</span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=10.10.10.11 //zabbix服务器ip</span><br><span class="line">ServerActive=10.10.10.11	//zabbix服务器ip</span><br><span class="line">Hostname=10.10.10.111	//自己的ip</span><br><span class="line">c:\zabbix\bin\win64\zabbix_agentd.exe -c c:\zabbix\conf\zabbix_agentd.win.conf -i	//将进程添加到服务管理</span><br><span class="line">c:\zabbix\bin\win64\zabbix_agentd.exe -c c:\zabbix\conf\zabbix_agentd.win.conf -s	//开启服务</span><br></pre></td></tr></table></figure><h4 id="六、浏览器端配置">六、浏览器端配置</h4><p>登录zabbix <a target="_blank" rel="noopener" href="http://ip/zabbix">http://ip/zabbix</a><br> 用户名 Admin 密码： zabbix</p><p>1、 添加监控主机<br> 配置 | 主机 | 创建主机 | 模板 | 选择模板 | 添加模板 | 添加主机<br> 添加模板时，一般默认必须选择以下2项<br> Template ICMP Ping<br> Template OS Linux</p><p>2、 配置监控 Nginx 并发量脚本（自定义脚本）</p><h5 id="一、编译安装nginx，开启-nginx status 状态信息">一、编译安装Nginx，开启 Nginx status 状态信息</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_stub_status_module</span><br><span class="line"># make &amp;&amp; make install</span><br><span class="line">添加监控模块</span><br><span class="line"># vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line">location /xabbix &#123;</span><br><span class="line">  stub_status on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="二、zabbix-客户端配置">二、Zabbix 客户端配置</h5><p>1、编写客户机端脚本 nginx_stats.sh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/zabbix/zabbix_agentd.d/nginx_stats.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"># Description：zabbix监控nginx性能以及进程状态</span><br><span class="line"># Note：此脚本需要配置在被监控端，否则ping检测将会得到不符合预期的结果</span><br><span class="line">HOST=&quot;127.0.0.1&quot;</span><br><span class="line">PORT=&quot;80&quot;</span><br><span class="line"># 检测nginx进程是否存在</span><br><span class="line">function ping &#123;</span><br><span class="line">/sbin/pidof nginx | wc -l </span><br><span class="line">&#125;</span><br><span class="line"># 检测nginx性能</span><br><span class="line">function active &#123;</span><br><span class="line">  /usr/bin/curl &quot;http://$HOST:$PORT/xabbix/&quot; 2&gt;/dev/null| grep &#x27;Active&#x27; | awk &#x27;&#123;print $NF&#125;&#x27; </span><br><span class="line">&#125;</span><br><span class="line">function reading &#123;</span><br><span class="line">  /usr/bin/curl &quot;http://$HOST:$PORT/xabbix/&quot; 2&gt;/dev/null| grep &#x27;Reading&#x27; | awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function writing &#123;</span><br><span class="line">  /usr/bin/curl &quot;http://$HOST:$PORT/xabbix/&quot; 2&gt;/dev/null| grep &#x27;Writing&#x27; | awk &#x27;&#123;print $4&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function waiting &#123;</span><br><span class="line">  /usr/bin/curl &quot;http://$HOST:$PORT/xabbix/&quot; 2&gt;/dev/null| grep &#x27;Waiting&#x27; | awk &#x27;&#123;print $6&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function accepts &#123;</span><br><span class="line">  /usr/bin/curl &quot;http://$HOST:$PORT/xabbix/&quot; 2&gt;/dev/null| awk NR==3 | awk &#x27;&#123;print $1&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function handled &#123;</span><br><span class="line">  /usr/bin/curl &quot;http://$HOST:$PORT/xabbix/&quot; 2&gt;/dev/null| awk NR==3 | awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function requests &#123;</span><br><span class="line">  /usr/bin/curl &quot;http://$HOST:$PORT/xabbix/&quot; 2&gt;/dev/null| awk NR==3 | awk &#x27;&#123;print $3&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"># 执行function</span><br><span class="line">$1</span><br></pre></td></tr></table></figure><p>2、在客户机将自定义的UserParameter加入配置文件，然后重启agentd<br> 将脚本存在该目录下 ： /etc/zabbix/zabbix_agentd.d，修改UserParameter的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">UserParameter=nginx.status[*],/etc/zabbix/zabbix_agentd.d/nginx_stats.sh $1</span><br><span class="line"># killall zabbix_agentd</span><br><span class="line"># /etc/init.d/zabbix-agent restart</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3、在服务器使用zabbix_get获取数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-get-3.2.11-1.el7.x86_64.rpm</span><br><span class="line"># zabbix_get -s 10.10.10.11 -k &#x27;nginx.status[accepts]&#x27;</span><br><span class="line"># zabbix_get -s 10.10.10.11 -k &#x27;nginx.status[ping]&#x27;</span><br></pre></td></tr></table></figure><p>4、浏览器配置Nginx 服务器并添加 Nginx 监控模板<br> 浏览器操作</p><ol><li>配置 | 模板 | 导入 | 选择文件 | 导入</li><li>配置 | 主机 | 创建主机 | 模板 | 选择模板 | 添加模板 | 添加主机</li></ol><blockquote><p>添加模板时，一般默认必须选择以下2项<br> Template ICMP Ping<br> Template OS Linux<br> Template App NGINX 选择刚才导入的模板</p></blockquote><p>3、 链接钉钉报警</p><blockquote><p>a、添加钉钉机器人，复制出机器码<br> b 、Zabbix 配置文件中查找”Alert”查看告警脚本存放路径：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</span><br></pre></td></tr></table></figure><p>c、进入配置中路径创建配置文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /usr/lib/zabbix/alertscripts/</span><br><span class="line">[root@localhost alertscripts]# vim token.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">to=$1</span><br><span class="line">subject=$2</span><br><span class="line">text=$3</span><br><span class="line">curl &#x27;****钉钉机器码填在此处*******&#x27; \</span><br><span class="line">-H &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">-d &#x27;</span><br><span class="line">&#123;&quot;msgtype&quot;: &quot;text&quot;,</span><br><span class="line">&quot;text&quot;: &#123;</span><br><span class="line">&quot;content&quot;: &quot;&#x27;&quot;$text&quot;&#x27;&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;at&quot;:&#123;</span><br><span class="line">&quot;atMobiles&quot;: [ &quot;&#x27;&quot;$1&quot;&#x27;&quot; ],</span><br><span class="line">&quot;isAtAll&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure><p>d、修改权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost alertscripts]# chown zabbix.zabbix token.sh</span><br><span class="line">[root@localhost alertscripts]# chmod +x token.sh</span><br></pre></td></tr></table></figure><p>e、配置浏览器端</p><blockquote><p>管理 | 报警媒介类型 | 创建媒介类型····</p><p>配置 | 动作 | 事件源[触发器] 创建动作 ·····</p><p>管理 | 用户 | admin | 报警媒介 | 添加 | 收件人填电话 | 填加</p></blockquote><div id="reword-out"><div id="reward-btn"> 打赏</div></div></div><div class="declare"><ul class="post-copyright"><li><i class="ri-copyright-line"></i> <strong>版权声明：</strong> 本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！</li></ul></div><footer class="article-footer"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Zabbix/" rel="tag">Zabbix</a></li></ul></footer></div><nav class="article-nav"> <a href="/2019/06/%E8%A7%A3%E5%86%B3%E5%9B%A0U%E7%9B%98%E6%A0%87%E7%AD%BE%E9%97%AE%E9%A2%98%E5%AF%BC%E8%87%B4%E7%9A%84U%E7%9B%98%E5%AE%89%E8%A3%85Linux%E7%B3%BB%E7%BB%9F%E5%A4%B1%E8%B4%A5/index.html" class="article-nav-link"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title"> 解决因U盘标签问题导致的U盘安装Linux系统失败</div></a> <a href="/2019/05/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8NTP%E6%90%AD%E5%BB%BA/index.html" class="article-nav-link"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">时间同步服务器NTP搭建</div></a></nav><script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script><div id="twikoo" class="twikoo"></div><script>twikoo.init({envId:""})</script></article></section><footer class="footer"><div class="outer"><ul><li> Copyrights &copy; 2018-2024<i class="ri-heart-fill heart_icon"></i> Outsrkem</li></ul><ul><li></li></ul><ul><li><span><span><i class="ri-user-3-fill"></i> 访问人数:<span id="busuanzi_value_site_uv"></span></span> <span class="division">|</span><span><i class="ri-eye-fill"></i> 浏览次数:<span id="busuanzi_value_page_pv"></span></span></span></li></ul><ul></ul><ul></ul><ul><li><script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914"></script></li></ul></div></footer></main><div class="float_btns"><div class="totop" id="totop"><i class="ri-arrow-up-line"></i></div><div class="todark" id="todark"><i class="ri-moon-line"></i></div></div><aside class="sidebar on"> <button class="navbar-toggle"></button><nav class="navbar"><div class="logo"> <a href="/"><img src="/images/ayer-side.svg" alt="Outsrkem"></a></div><ul class="nav nav-main"><li class="nav-item"> <a class="nav-item-link" href="/index.html">主页</a></li><li class="nav-item"> <a class="nav-item-link" href="/archives/index.html">归档</a></li><li class="nav-item"> <a class="nav-item-link" href="/categories/index.html">分类</a></li><li class="nav-item"> <a class="nav-item-link" href="/tags/index.html">标签</a></li><li class="nav-item"> <a class="nav-item-link" href="/friends/index.html">友链</a></li><li class="nav-item"> <a class="nav-item-link" href="/about/index.html">关于</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="ri-search-line"></i></a></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"> <input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><div id="mask"></div> <div id="reward"><span class="close"><i class="ri-close-line"></i></span><p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p><div class="reward-box"><div class="reward-item"> <img class="reward-img" src="/images/alipay.jpg"> <span class="reward-type">支付宝</span></div><div class="reward-item"> <img class="reward-img" src="/images/wechat.jpg"> <span class="reward-type">微信</span></div></div></div><script src="/js/jquery-3.6.0.min.js"></script><script src="/js/lazyload.min.js"></script><script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"><script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script><script src="/dist/main.js"></script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css"><script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script><script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script><script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script><script src="/js/busuanzi-2.3.pure.min.js"></script><link rel="stylesheet" href="/css/clipboard.css"><script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script><script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></div></body>